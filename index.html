<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FChain Demo Wallet</title>

<style>
body{margin:0;font-family:Arial;background:#0f172a;color:white;}
.page{display:none;padding:15px;}
.active{display:block;}
h2{text-align:center;}
input{width:100%;padding:12px;margin:6px 0;border-radius:8px;border:none;}
.btn{width:100%;padding:14px;background:#2563eb;border:none;border-radius:10px;color:white;font-size:16px;margin-top:10px;}
.btn:hover{background:#1e40af;}
.card{background:#111827;padding:12px;border-radius:12px;margin-top:10px;}
.bottom-nav{position:fixed;bottom:0;width:100%;display:flex;background:#020617;border-top:1px solid #1e293b;}
.nav-btn{flex:1;text-align:center;padding:10px;color:#94a3b8;font-size:14px;}
.nav-btn:hover{color:white;}
.netbar{width:100%;height:6px;background:#111827;border-radius:10px;overflow:hidden;margin:5px 0;}
.netfill{height:100%;background:#22c55e;width:0%;transition:width 1s;}
video{width:100%;border-radius:12px;}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginPage" class="page active">
<h2>FChain Demo Wallet Login</h2>
<input id="emailInput" placeholder="Email">
<input id="passwordInput" type="password" placeholder="Password">
<button class="btn" onclick="loginUser()">Login</button>
<p style="text-align:center;font-size:12px;color:#94a3b8;">Demo mode: Any email works</p>
</div>

<!-- HOME -->
<div id="home" class="page">
<h2>FChain Wallet</h2>

<h1 id="totalBalance">$0.00</h1>

<div class="card">BTC Balance: <span id="btcBal">0.000000</span></div>
<div class="card">ETH Balance: <span id="ethBal">0.000000</span></div>
<div class="card">FCH Token: <span id="fchBal">0</span></div>

<button class="btn" onclick="openPage('receive')">Receive</button>
<button class="btn" onclick="openPage('profile')">Profile</button>
<button class="btn" onclick="resetDemo()">Reset Demo Login</button>
</div>

<!-- RECEIVE (REAL CAMERA QR SCANNER) -->
<div id="receive" class="page">
<button class="btn" onclick="stopScan();openPage('home')">⬅ Back</button>
<h2>Scan QR Wallet Address</h2>

<video id="qrVideo" autoplay></video>
<p id="qrResult" style="text-align:center;color:#22c55e;"></p>

<button class="btn" onclick="startScan()">Start QR Scanner</button>
</div>

<!-- PROFILE -->
<div id="profile" class="page">
<button class="btn" onclick="openPage('home')">⬅ Back</button>
<h2>User Profile</h2>
<div class="card">Username: <span id="profileUser"></span></div>
<div class="card">Email: <span id="profileEmail"></span></div>
</div>

<!-- NETWORK BAR ABOVE NAV -->
<div class="netbar"><div id="netFill" class="netfill"></div></div>

<!-- BOTTOM NAV -->
<div class="bottom-nav">
  <div class="nav-btn" onclick="openPage('home')">Home</div>
  <div class="nav-btn" onclick="openPage('receive')">Receive</div>
  <div class="nav-btn" onclick="openPage('profile')">Profile</div>
</div>

<!-- QR Scanner Library -->
<script src="https://unpkg.com/jsqr/dist/jsQR.js"></script>

<script>
// -------- NAVIGATION --------
function openPage(id){
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

// -------- LOGIN SYSTEM --------
function loginUser(){
  const email = emailInput.value.trim();
  const password = passwordInput.value.trim();
  if(!email || !password){ alert("Enter email & password"); return; }

  localStorage.setItem("demoEmail", email);
  loadUser(email);
  openPage("home");
}

window.onload = function(){
  const email = localStorage.getItem("demoEmail");
  if(email){
    loadUser(email);
    openPage("home");
  }
};

function loadUser(email){
  profileUser.innerText = email.split("@")[0];
  profileEmail.innerText = email;

  // ZERO balances (fresh wallet)
  btcBal.innerText = "0.000000";
  ethBal.innerText = "0.000000";
  fchBal.innerText = "0";
  totalBalance.innerText = "$0.00";
}

function resetDemo(){
  localStorage.clear();
  alert("Reset done");
  location.reload();
}

// -------- NETWORK MOVING BAR --------
setInterval(()=>{
  netFill.style.width = Math.floor(Math.random()*100)+"%";
},2000);

// -------- REAL QR SCANNER (CAMERA) --------
let videoStream;

async function startScan(){
  const video = document.getElementById("qrVideo");

  videoStream = await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});
  video.srcObject = videoStream;

  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");

  function scan(){
    if(video.readyState === video.HAVE_ENOUGH_DATA){
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video,0,0,canvas.width,canvas.height);
      const imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
      const code = jsQR(imageData.data, canvas.width, canvas.height);
      if(code){
        qrResult.innerText = "Scanned: " + code.data;
      }
    }
    requestAnimationFrame(scan);
  }
  scan();
}

function stopScan(){
  if(videoStream){
    videoStream.getTracks().forEach(track=>track.stop());
  }
}
</script>

</body>
  </html>
