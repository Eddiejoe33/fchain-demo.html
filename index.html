<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FChain Wallet</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAcbSgzaILvD01pZLGJUasTCE2tjMLq-fw",
  authDomain: "fchainwallet-a353d.firebaseapp.com",
  projectId: "fchainwallet-a353d",
  storageBucket: "fchainwallet-a353d.appspot.com",
  messagingSenderId: "194040190119",
  appId: "1:194040190119:web:843ea9ed014a80e52f3782"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Default balance
function defaultBalance(){
  return {btc:0, eth:0, fch:0};
}

// Load user
async function loadUser(username){
  const ref = doc(db,"wallets",username);
  const snap = await getDoc(ref);

  if(!snap.exists()){
    await setDoc(ref, defaultBalance());
    return defaultBalance();
  }
  return snap.data();
}

// Save balance (ADMIN)
async function adminSetBalance(username, btc, eth, fch){
  const ref = doc(db,"wallets",username);
  await updateDoc(ref,{btc, eth, fch});
  alert("Balance Updated");
}

window.loadUser = loadUser;
window.adminSetBalance = adminSetBalance;
</script>

<style>
body{background:#0b1220;color:white;font-family:Arial;margin:0;}
.page{display:none;padding:15px;}
.active{display:block;}
input{width:100%;padding:12px;margin-top:10px;border:none;border-radius:8px;background:#111827;color:white;}
button{width:100%;padding:12px;margin-top:10px;background:#1f4cff;border:none;border-radius:10px;color:white;font-weight:bold;}
.card{background:#111827;padding:12px;border-radius:12px;margin-top:10px;}
.bottom-nav{position:fixed;bottom:0;width:100%;display:flex;background:#020617;}
.nav-btn{flex:1;padding:10px;text-align:center;color:#94a3b8;cursor:pointer;}
.nav-btn.active{color:white;font-weight:bold;}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginPage" class="page active">
<h2>FChain Wallet Login</h2>
<input id="username" placeholder="Username">
<input id="password" type="password" placeholder="Password (not real)">
<button onclick="login()">Login</button>
</div>

<!-- HOME -->
<div id="home" class="page">
<h2>Total Balance</h2>
<h1 id="balance">$0.00</h1>

<div class="card">BTC: <span id="btcBal">0.000000</span></div>
<div class="card">ETH: <span id="ethBal">0.000000</span></div>
<div class="card">FCH: <span id="fchBal">0</span></div>

<button onclick="openPage('profile')">Profile</button>
<button onclick="openPage('admin')">Admin Panel</button>
</div>

<!-- PROFILE -->
<div id="profile" class="page">
<h2>Profile</h2>
<div class="card">User: <span id="profileUser"></span></div>
<div class="card">Wallet: <span id="walletAddr"></span></div>
<button onclick="openPage('home')">Back</button>
</div>

<!-- ADMIN PANEL -->
<div id="admin" class="page">
<h2>Admin Balance Editor</h2>
<input id="adminUser" placeholder="Username">
<input id="adminBTC" placeholder="BTC Balance">
<input id="adminETH" placeholder="ETH Balance">
<input id="adminFCH" placeholder="FCH Balance">
<button onclick="adminUpdate()">Update Balance</button>
<button onclick="openPage('home')">Back</button>
</div>

<div class="bottom-nav">
  <div class="nav-btn active" onclick="openPage('home')">Home</div>
  <div class="nav-btn" onclick="openPage('profile')">Profile</div>
  <div class="nav-btn" onclick="openPage('admin')">Admin</div>
</div>

<script>
// Page navigation
function openPage(id){
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

// Login (fake)
async function login(){
  const u = username.value;
  if(!u){alert("Enter username"); return;}
  localStorage.setItem("user",u);
  await loadWallet();
}

// Load wallet
async function loadWallet(){
  const u = localStorage.getItem("user");
  const data = await loadUser(u);

  btcBal.innerText = data.btc.toFixed(6);
  ethBal.innerText = data.eth.toFixed(6);
  fchBal.innerText = data.fch;

  balance.innerText = "$0.00"; // force 0 display

  profileUser.innerText = u;
  walletAddr.innerText = "0xDEMO_" + u;

  openPage("home");
}

// Admin update
async function adminUpdate(){
  await adminSetBalance(
    adminUser.value,
    parseFloat(adminBTC.value),
    parseFloat(adminETH.value),
    parseFloat(adminFCH.value)
  );
}

// Auto login
if(localStorage.getItem("user")) loadWallet();
</script>

</body>
</html>
